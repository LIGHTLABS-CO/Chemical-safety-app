<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lighthouse Labs Weather Monitor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="banner">LIGHTHOUSE LABS</div>
  <div class="container">
    <div style="text-align:center; margin-bottom: 1rem;">
      <button onclick="selectBase('escravos')">Weather Monitoring at Escravos Terminal, Chevron</button>
      <button onclick="selectBase('ekpan')">Weather Monitoring at Tank Farm, Chevron</button>
    </div>
    <div id="base-name"></div>
    <div id="weather"></div>
    <div id="forecast"></div>
    <div id="countdown"></div>
  </div>
  <script>
    const apiKey = '7ce545e8426a719062d9f8a7795d1e56';
    const bases = {
      escravos: {
        name: 'Weather Monitoring at Escravos Terminal, Chevron',
        lat: 5.6167,
        lon: 5.2167
      },
      ekpan: {
        name: 'Weather Monitoring at Tank Farm, Chevron',
        lat: 5.5333,
        lon: 5.7667
      }
    };let currentInterval = null;
let countdownInterval = null;
let nextUpdateIn = 600; // seconds

function selectBase(baseKey) {
  const base = bases[baseKey];
  document.getElementById('base-name').innerText = base.name;
  fetchWeather(base);

  if (currentInterval) clearInterval(currentInterval);
  if (countdownInterval) clearInterval(countdownInterval);

  currentInterval = setInterval(() => fetchWeather(base), 600000); // 10 minutes
  countdownInterval = setInterval(updateCountdown, 1000);
  nextUpdateIn = 600;
}

function updateCountdown() {
  const countdown = document.getElementById('countdown');
  const mins = Math.floor(nextUpdateIn / 60);
  const secs = nextUpdateIn % 60;
  countdown.innerText = `Next update in: ${mins}m ${secs < 10 ? '0' : ''}${secs}s`;
  if (nextUpdateIn > 0) nextUpdateIn--;
}

async function fetchWeather(base) {
  const weatherDiv = document.getElementById('weather');
  const forecastDiv = document.getElementById('forecast');
  try {
    const [weatherRes, forecastRes] = await Promise.all([
      fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${base.lat}&lon=${base.lon}&appid=${apiKey}&units=metric`),
      fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${base.lat}&lon=${base.lon}&appid=${apiKey}&units=metric`)
    ]);

    const weather = await weatherRes.json();
    const forecast = await forecastRes.json();

    weatherDiv.innerHTML = `
      <div class="data-point"><strong>Temperature:</strong> ${weather.main.temp} Â°C</div>
      <div class="data-point"><strong>Humidity:</strong> ${weather.main.humidity}%</div>
      <div class="data-point"><strong>Wind Speed:</strong> ${weather.wind.speed} m/s</div>
      <div class="data-point"><strong>Weather:</strong> ${weather.weather[0].description}</div>
    `;

    forecastDiv.innerHTML = '';
    for (let i = 0; i < 5; i++) {
      const entry = forecast.list[i];
      forecastDiv.innerHTML += `
        <div>
          <div><strong>${entry.dt_txt}</strong></div>
          <div>ðŸŒ¡ ${entry.main.temp} Â°C</div>
          <div>ðŸ’§ ${entry.main.humidity}%</div>
          <div>ðŸŒ¬ ${entry.wind.speed} m/s</div>
        </div>
      `;
    }
    nextUpdateIn = 600;
  } catch (err) {
    weatherDiv.innerText = 'Error fetching weather data.';
    forecastDiv.innerHTML = '';
  }
}

  </script>
</body>
</html>
